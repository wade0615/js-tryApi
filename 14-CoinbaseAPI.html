<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14-Coinbase API</title>
</head>
<body>
    <h1 class="date"></h1>
    <div class="container">
        <div class="bitcoin">1 Bitcoin =</div>
        <div class="usd"></div>
        <div class="or">OR</div>
        <div class="twd"></div>
    </div>

    <style>
    .container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        font-size: 30px;
    }   
    </style>

    <script>
        var currency = "BTC";
        var url = "https://api.coinbase.com/v2/exchange-rates?currency=" + currency;
        var usd = document.querySelector(".usd");
        var twd = document.querySelector(".twd");
        const date = document.querySelector('.date');

        const currentTime = new Date();
        const currentYear = currentTime.getFullYear();
        const currentMonth = currentTime.getMonth() + 1;
        const currentDate = currentTime.getDate();
        const nowDate = `${currentYear}-${currentMonth}-${currentDate}`
        console.log(nowDate);
        date.innerHTML = nowDate;

        // function makeRequest() {
        //     xhr = new XMLHttpRequest();

        //     xhr.onload = function() {
        //         var response = JSON.parse(this.responseText);
        //         usd.innerHTML = response.data.rates.USD + " USD";
        //         twd.innerHTML = response.data.rates.TWD + " TWD";
        //     };
        //     xhr.open("GET", url, true);
        //     xhr.setRequestHeader("CB-VERSION", "2018-01-01");
        //     xhr.send();
        // }
        // makeRequest();

        fetch(url, {
            method: 'GET',
            headers: {
                "CB-VERSION": nowDate
            },
        })
            .then(response => response.json())
            .then(response => {
                usd.innerHTML = response.data.rates.USD + " USD";
                twd.innerHTML = response.data.rates.TWD + " TWD";
                // console.log("I'm fetch");
            })
            .catch( () => console.log('Something Wrong'))
        
    </script>
</body>
</html>